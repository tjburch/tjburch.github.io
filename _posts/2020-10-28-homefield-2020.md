---
layout: post
title: "Home-field Advantage in 2020"
date: 2020-10-28
categories: Baseball
tags: [baseball, statistics, bayesian]
---

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


As a result of the COVID pandemic, baseball in 2020 has looked very different. Several rule changes have changed the appearance of the on-field game: designated hitters in the National League, runners starting on second in extra innings, 7-inning double headers, three-batter minimums for pitchers, and new roster limits. However, I've been interested in the impact of a change off the field: home-field advantage. As a result of the pandemic, cardboard cutouts and simulated stadium sounds have replaced human fans, which begs the question: with no fans, does home-field advantage still exist? If so, to what degree?

There's been quite a bit of writing about this, to mixed results. Ben Lindbergh at The Ringer argued that [home-field advantage did persist in 2020](https://www.theringer.com/2020/9/30/21494861/playoffs-home-field-advantage-wild-card), while Mike Petriello at MLB says the opposite, [citing the 50.5% home winning percentage](https://www.mlb.com/news/home-field-advantage-has-disappeared-in-2020). Tyler Kepner at the New York Times goes as far as to argue that [home-field advantage _never_ existed](https://www.nytimes.com./2020/09/25/sports/baseball/mlb-postseason-home-field-advantage.html). I sought to understand what we can truly say about home-field advantage given the abbreviated 60-game season.

<img src="/blogimages/home-field/fans.jpeg" class="center" style="width:65%;">


## Methodology

The goal in this study is to estimate the degree to which home-field advantage exists, which will be estimated by a _run advantage_, or "how many more runs we can expect from a home team compared to an away team." In order to estimate this, I'll be doing parameter estimation via Bayesian inference. This means that we assume there is some underlying "true home-field advantage," and the run advantage in each game is a realization of a random sample of this parameter. 

To do this estimation, I developed a generalized linear model to predict the number of runs a team will produce in a game. The outcome variable of runs, being a count value, must be modeled with a discrete distribution, since it only takes on integer values. I've used a negative binomial (or gamma-Poisson) model to model this distribution. The negative binomial distribution is a Poisson distribution that assumes each count observation has its own rate, resulting in 2 free parameters, which allows for more flexibility than the traditional Poisson distribution.

Next, I assume the mean of the negative binomial comes from the log of a linear function with 4 predictors. I assume the scoring in a game is impacted by 4 sources: 

- $$S_i$$ - The team's strength
- $$P_i$$ - The opposing pitcher's strength
- $$H_i$$ - The league-wide home-field advantage
- $$\tau_{\text{STADIUM}[i]}$$ - Park effects for each individual stadium

In order to model team and pitcher strength, I've used values from an (ELO rating system)[https://en.wikipedia.org/wiki/Elo_rating_system], which calculates relative skill levels in zero-sum games, under the assumption that performance is normally distributed. Luckily, FiveThirtyEight maintains [game-wise ELO values](https://github.com/fivethirtyeight/data/tree/master/mlb-elo) for each team and adjustments for opposing pitcher strength, so these were used as predictors. Additionally, there's different run-scoring environments in various stadiums, so that is controlled for as well by adding a categorical intercept for each individual stadium. Last being a linear model, I also have an intercept $$\alpha_1$$.

Using Bayesian inference means priors expectations must be assigned to each parameter. This has been done fairly conservatively, I've given everything a wide normal distribution. By definition, the ELO values follow this value, and I've renormalized them such that they're centered at zero with a standard deviation of 1. The home-field advantage value is given a relatively small normal distribution, since the effect, if it exists, is usually estimated between 0.1 and 0.2 runs - I've given it a normal distribution with standard deviation 0.25. I used a similar logic for the stadium effect, using deviation 0.1, since park factors are usually within 10%. Last, the second parameter of the negative biomial distribution, $$\alpha_i$$, is the gamma distribution parameter, which must be positive, so I gave it a flat prior over a _very_ wide range of 0 to 10. 

 In it's completeness:

<img src="/blogimages/home-field/2020/model.png" class="center" style="width:50%;">

## Data

As mentioned before, I've used the ELO CSV from FiveThirtyEight. For the first part of this analysis I've selected just data from the 2020 regular season, which occur at non-neutral sites. The team ELO and pitcher adjustment values were standardized (mean moved to 0, standard deviation to 1). Home team is saved as a boolean value, 1 for home and 0 for away, and stadium is saved as the home team in any given matchup, which is encoded into an index ranging from 0 to 29.

## Model Sampling

The model was constructed using [pyMC3](https://docs.pymc.io/), and I've drawn 20,000 sample parameter sets from the posterior distribution<sup>1</sup> - possible parameters which may have generated our data given the priors and conditional on the runs scored in 2020. Using this, we can draw predictions from our model,

<img src="/blogimages/home-field/2020/run_distribution.png" class="center" style="width:60%;">

The inner green band on this plot covers the 68% ($$1\sigma$$) most common outcomes, the yellow band covers the 95% ($$2\sigma$$) most common. The most-likely value is shown with the solid black line, and the 2020 actual result is shown with the markers (Poisson errors are shown). Here we can see this model covers our data quite well, all of the true values lie within the $$2\sigma$$ band, with just a couple of error bars slightly falling out.

## Evaluating Home-Field Advantage

Now that we have a model that can predict the runs a team will score, we can use this model to generate new predictions. For each of the 20,000 parameter sets, a new season is simulated - 30 home games and 30 away games for each of the 30 teams. Then we can compare the mean score of the home games to the away games for all teams in the league for each simulation to understand the home-field advantage.

<img src="/blogimages/home-field/2020/home_away_split.png" class="center" style="width:60%;">

These histograms show each simulated season's mean home and away scores, and the peak of the home scores lies above that of the away scores - the model shows home-field advantage does seem to exist, to some degree. We can then take the difference of these two distributions to quantify how much.

<img src="/blogimages/home-field/2020/home_field_advantage.png" class="center" style="width:60%;">

The mean of this distribution lies at 0.205, indicating that most likely home team gets an advantage of about 1/5th of a run when playing at home (this could be interpreted as "one extra run every 5 games" for those uncomfortable with fractional runs). The true value in 2020 is also shown<sup>2</sup>, at 0.196. The 95% credible interval here spans from -0.252 to 0.665, which means this analysis can't necessarily rule out the idea that no such effect does exist, nor can the analysis rule out that it was worth half a run in 2020. However, the lower 1$$\sigma$$ deviation does lie above 0, implying that we can be at least 84% sure that home-field advantage is a positive value.

## Comparing to Previous Years

To get an idea of how this benchmarks against previous years, I re-ran this analysis for every year since 2014. The model and approach were held constant, the only difference was conditioning on each year's respective data set. To see if home-field advantage in 2020 was different, I plotted the predictions for each year, looking at the 95% credible interval:

<img src="/blogimages/home-field/2020/multiyear_hfa.png" class="center" style="width:55%;">

2020 has a wider prediction interval due to the shortened season. From this plot, it's tough to say anything entirely definitive about home-field advantage - just like in 2020, we can't rule out 0 at the 95% CI, nor can we rule out quite sizeable effects in any given year. However, In all years but 2019, the bulk of the probability distribution lies above 0, so we can be reasonably confident that there's a positive home-field advantage effect on run scoring.

## Summary

Going back to the claims, it seems that we don't quite have enough evidence to rule out any claim definitively. I would argue it's hard to justify that home-field advantage _never_ existed, since each of these years have a large portion of their probability interval being a positive value, but _technically_ all could be consistent with 0. Otherwise, home-field advantage at the run-level in 2020 doesn't look all that dissimilar to prior years - the way the prediction interval lies, it's more consistent with other years in which it took a positive value. The most likely value per this analysis is about 1/5th of a run, so I would agree most with Lindbergh's claim that removing fans did not remove MLB's home-field advantage.


## Extending this work

In this analysis, I've considered home-field advantage as a league-wide phenomena, implying every team has the same run advantage while playing at home. This assumption worked for the context of the study, since the lack of fans was league wide. However, it might not be entirely true. While at some level stadium effects should cover variation in stadiums themselves, it could be that some teams have a higher home-field advantage. Breaking this data down even further into team levels would cause data sparsity though, only 30 home and 30 away games per team - this is something that would justify a hierarchical modeling approach.

Further, considering home-field advantage as an independent analysis for each year isn't entirely justified, there ought to be some continuity in value between years. However, it's dependent on run scoring environment (e.g. the recent home run surge will likely make an impact), so a time-varying model could also be considered in order to take advantage of year-to-year data while accounting for temporal variation.

Last, this analysis looked at the run-level effect of home-field advantage, but a more granular study could be performed. The [Lindbergh piece](https://www.theringer.com/2020/9/30/21494861/playoffs-home-field-advantage-wild-card) cited above studies at-bat level data, which would provide more statistics to perhaps give stronger claims on how home-field advantage affects at the player level.

----
### Footnotes

1) Model converges nicely, trace plot:

<img src="/blogimages/home-field/2020/trace_check.png" class="center" style="width:64%;">

2) Note, this value appearing right at the model peak isn't surprising - this is the data we've conditioned on, so in the sampling the model is pulling parameters to estimate this exact value. Thus, new predictions ought to be around this value.
